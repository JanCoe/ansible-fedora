- name: Install development tools. 
  become: true
  ansible.builtin.dnf:
    name: "{{ dev_tools }}"
    state: present

- name: Enable wezterm Copr repository.
  become: true
  ansible.builtin.command: dnf copr enable wezfurlong/wezterm-nightly -y

- name: Enable yazi Copr repository.
  become: true
  ansible.builtin.command: dnf copr enable lihaohong/yazi -y

- name: Add nushell repo using template.
  become: true
  ansible.builtin.template:
    src: yum.repo.j2
    dest: /etc/yum.repos.d/fury-nushell.repo
    mode: '0644'
  vars:
    repo_id: gemfury-nushell
    repo_name: Gemfury Nushell Repo
    baseurl: https://yum.fury.io/nushell/
    gpgcheck: 0
    gpgkey: https://yum.fury.io/nushell/gpg.key

- name: Install CLI tools.
  become: true
  ansible.builtin.dnf:
    name: "{{ cli_tools }}"
    state: present

- name: Install Rust toolchain.
  become: true 
  ansible.builtin.dnf:
    name: rustup
    state: present

- name: Install Rust toolchain.
  ansible.builtin.command:
    cmd: rustup install stable
  become: true 
  become_user: "{{ real_user }}"
  environment:
    PATH: "/home/{{ real_user }}/.cargo/bin:{{ ansible_env.PATH }}"
  args:
    creates: "/home/{{ real_user }}/.rustup/toolchains/stable-x86_64-unknown-linux-gnu"

- name: Ensure ~/.cargo/bin is in PATH for this session.
  shell: |
    echo 'export PATH="/home/{{ real_user }}/.cargo/bin:$PATH"' >> "/home/{{ real_user }}/.bashrc"

# this isn't working
- name: Install Cargo packages.
  community.general.cargo:
    name: 
      - cargo-update
      - cargo-watch
      - du-dust
      - dua
      - hyperfine
      - starship
      - tokei
    state: present
    executable: "/home/{{ real_user }}/.cargo/bin/cargo"
  become: true
  become_user: "{{ real_user }}"
  environment:
    PATH: "/home/{{ real_user }}/.cargo/bin:{{ ansible_env.PATH }}"

- name: Install Jetbrains toolbox.
  become: true
  ansible.builtin.dnf:
    name: fuse-libs
    state: present

- name: Create Projects directory.
  ansible.builtin.file:
    path: "/home/{{ real_user }}/Projects"
    state: directory
